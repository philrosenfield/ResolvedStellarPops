

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>resolvedstellarpops.graphics.plotting &mdash; ResolvedStellarPops 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../../../',
        VERSION:'1.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
    <script type="text/javascript">
        jQuery(function () {
            SphinxRtdTheme.StickyNav.enable();
        });
    </script>
  

  
    <link rel="top" title="ResolvedStellarPops 1.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../../index.html" class="fa fa-home"> ResolvedStellarPops</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="simple">
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ResolvedStellarPops</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>resolvedstellarpops.graphics.plotting</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for resolvedstellarpops.graphics.plotting</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">matplotlib.mlab</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">FancyArrow</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>

<span class="kn">from</span> <span class="nn">..tools</span> <span class="kn">import</span> <span class="n">parse_mag_tab</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;colorify&#39;</span><span class="p">,</span> <span class="s">&#39;colorplot_by_stage&#39;</span><span class="p">,</span> <span class="s">&#39;crazy_histogram2d&#39;</span><span class="p">,</span>
           <span class="s">&#39;discrete_colors&#39;</span><span class="p">,</span> <span class="s">&#39;latex_float&#39;</span><span class="p">,</span> <span class="s">&#39;make_hess&#39;</span><span class="p">,</span>
           <span class="s">&#39;plot_cmd_redding_vector&#39;</span><span class="p">,</span> <span class="s">&#39;plot_hess&#39;</span><span class="p">,</span> <span class="s">&#39;plot_hlines&#39;</span><span class="p">,</span> <span class="s">&#39;plot_numbs&#39;</span><span class="p">,</span>
           <span class="s">&#39;scatter_contour&#39;</span><span class="p">,</span> <span class="s">&#39;setup_multiplot&#39;</span><span class="p">,</span> <span class="s">&#39;setup_plot_by_stage&#39;</span><span class="p">,</span>
           <span class="s">&#39;stitch_cmap&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="colorify"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.colorify">[docs]</a><span class="k">def</span> <span class="nf">colorify</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Spectral</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Associate a color map to a quantity vector</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data: sequence</span>
<span class="sd">        values to index</span>

<span class="sd">    vmin: float, optional</span>
<span class="sd">        minimal value to index</span>

<span class="sd">    vmax: float, optional</span>
<span class="sd">        maximal value to index</span>

<span class="sd">    cmap: colormap instance</span>
<span class="sd">        colormap to use</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colors: sequence</span>
<span class="sd">        color sequence corresponding to data</span>

<span class="sd">    scalarMap: colormap</span>
<span class="sd">        generated map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="kn">as</span> <span class="nn">colors</span>

    <span class="n">_vmin</span> <span class="o">=</span> <span class="n">vmin</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">_vmax</span> <span class="o">=</span> <span class="n">vmax</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">cNorm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">_vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">_vmax</span><span class="p">)</span>

    <span class="n">scalarMap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">scalarMap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colors</span><span class="p">,</span> <span class="n">scalarMap</span>

</div>
<div class="viewcode-block" id="scatter_contour"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.scatter_contour">[docs]</a><span class="k">def</span> <span class="nf">scatter_contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                    <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">log_counts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">histogram2d_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">plot_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">contour_args</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot with contour over dense regions</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : arrays</span>
<span class="sd">        x and y data for the contour plot</span>

<span class="sd">    levels : integer or array (optional, default=10)</span>
<span class="sd">        number of contour levels, or array of contour levels</span>

<span class="sd">    threshold : float (default=100)</span>
<span class="sd">        number of points per 2D bin at which to begin drawing contours</span>

<span class="sd">    log_counts :boolean (optional)</span>
<span class="sd">        if True, contour levels are the base-10 logarithm of bin counts.</span>

<span class="sd">    histogram2d_args : dict</span>
<span class="sd">        keyword arguments passed to crazy_histogram2d</span>
<span class="sd">        see doc string of crazy_histogram2d for more information</span>

<span class="sd">    plot_args : dict</span>
<span class="sd">        keyword arguments passed to pylab.plot</span>
<span class="sd">        see doc string of pylab.plot for more information</span>

<span class="sd">    contourf_args : dict</span>
<span class="sd">        keyword arguments passed to pylab.contourf</span>
<span class="sd">        see doc string of pylab.contourf for more information</span>

<span class="sd">    ax : pylab.Axes instance</span>
<span class="sd">        the axes on which to plot.  If not specified, the current</span>
<span class="sd">        axes will be used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c"># H, xbins, ybins = np.histogram2d(x, y, **histogram2d_args)</span>
    <span class="c"># extent = [xbins[0], xbins[-1], ybins[0], ybins[-1]]</span>
    <span class="n">H</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="p">(</span><span class="n">xbin</span><span class="p">,</span> <span class="n">ybins</span><span class="p">)</span>  <span class="o">=</span> <span class="n">crazy_histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="o">**</span><span class="n">histogram2d_args</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">log_counts</span><span class="p">:</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">H</span><span class="p">)</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">threshold</span><span class="p">)</span>

    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">levels</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">levels</span><span class="p">)</span>

    <span class="n">i_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

    <span class="c"># draw a zero-width line: this gives us the outer polygon to</span>
    <span class="c"># reduce the number of points we draw</span>
    <span class="c"># somewhat hackish... we could probably get the same info from</span>
    <span class="c"># the filled contour below.</span>
    <span class="n">outline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="p">[</span><span class="n">i_min</span><span class="p">:</span><span class="n">i_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outer_poly</span> <span class="o">=</span> <span class="n">outline</span><span class="o">.</span><span class="n">allsegs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="o">**</span><span class="n">contour_args</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">y</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># this works in newer matplotlib versions</span>
            <span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span>
            <span class="n">points_inside</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">outer_poly</span><span class="p">)</span><span class="o">.</span><span class="n">contains_points</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># this works in older matplotlib versions</span>
            <span class="kn">import</span> <span class="nn">matplotlib.nxutils</span> <span class="kn">as</span> <span class="nn">nx</span>
            <span class="n">points_inside</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">points_inside_poly</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">outer_poly</span><span class="p">)</span>

        <span class="n">Xplot</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">points_inside</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Xplot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Xplot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">plot_args</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_args</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="latex_float"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.latex_float">[docs]</a><span class="k">def</span> <span class="nf">latex_float</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">r&#39;\times&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a float value into a pretty printable latex format</span>
<span class="sd">    makes 1.3123e-11 transformed into $1.31 x 10 ^ {-11}$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f: float</span>
<span class="sd">        value to convert</span>

<span class="sd">    precision: float, optional (default: 0.2)</span>
<span class="sd">        the precision will be used as the formatting: {precision}g</span>
<span class="sd">        default=0.2g</span>

<span class="sd">    delimiter: str, optional (default=r&#39;\times&#39;)</span>
<span class="sd">        delimiter between the value and the exponent part</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">float_str</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;{0:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;g}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&quot;e&quot;</span> <span class="ow">in</span> <span class="n">float_str</span><span class="p">:</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">=</span> <span class="n">float_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">r&quot;{0}&quot;</span> <span class="o">+</span> <span class="n">delimiter</span> <span class="o">+</span> <span class="s">&quot;10^{{{1}}}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">exponent</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">float_str</span>

</div>
<div class="viewcode-block" id="crazy_histogram2d"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.crazy_histogram2d">[docs]</a><span class="k">def</span> <span class="nf">crazy_histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reduce_w</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">NULL</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reinterp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the sparse bi-dimensional histogram of two data samples where *x*,</span>
<span class="sd">    and *y* are 1-D sequences of the same length. If *weights* is None</span>
<span class="sd">    (default), this is a histogram of the number of occurences of the</span>
<span class="sd">    observations at (x[i], y[i]).</span>

<span class="sd">    If *weights* is specified, it specifies values at the coordinate (x[i],</span>
<span class="sd">    y[i]). These values are accumulated for each bin and then reduced according</span>
<span class="sd">    to *reduce_w* function, which defaults to numpy&#39;s sum function (np.sum).</span>
<span class="sd">    (If *weights* is specified, it must also be a 1-D sequence of the same</span>
<span class="sd">    length as *x* and *y*.)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x: ndarray[ndim=1]</span>
<span class="sd">        first data sample coordinates</span>

<span class="sd">    y: ndarray[ndim=1]</span>
<span class="sd">        second data sample coordinates</span>

<span class="sd">    bins: int or [int, int], optional</span>
<span class="sd">        the bin specification</span>
<span class="sd">        `int`       : the number of bins for the two dimensions (nx=ny=bins)</span>
<span class="sd">        `[int, int]`: the number of bins in each dimension (nx, ny = bins)</span>

<span class="sd">    weights: ndarray[ndim=1], optional</span>
<span class="sd">        values *w_i* weighing each sample *(x_i, y_i)*, they will be</span>
<span class="sd">        accumulated and reduced (using reduced_w) per bin</span>

<span class="sd">    reduce_w: callable, optional (default=np.sum)</span>
<span class="sd">        function that will reduce the *weights* values accumulated per bin</span>
<span class="sd">        defaults to numpy&#39;s sum function (np.sum)</span>

<span class="sd">    NULL: value type, optional</span>
<span class="sd">        filling missing data value</span>

<span class="sd">    reinterp: str in [None, &#39;nn&#39;, linear&#39;], optional</span>
<span class="sd">        if set, reinterpolation is made using mlab.griddata to fill missing</span>
<span class="sd">        data within the convex polygone that encloses the data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    B: ndarray[ndim=2]</span>
<span class="sd">        bi-dimensional histogram</span>

<span class="sd">    extent: tuple(4)</span>
<span class="sd">        (xmin, xmax, ymin, ymax) entension of the histogram</span>

<span class="sd">    steps: tuple(2)</span>
<span class="sd">        (dx, dy) bin size in x and y direction</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># define the bins (do anything you want here but needs edges and sizes of the 2d bins)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">bins</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">bins</span>

    <span class="c">#values you want to be reported</span>
    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">reduce_w</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">reduce_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reduce_w</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;reduce function is not callable&#39;</span><span class="p">)</span>

    <span class="c"># culling nans</span>
    <span class="n">finite_inds</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">finite_inds</span><span class="p">]</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="n">finite_inds</span><span class="p">]</span>
    <span class="n">_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">)[</span><span class="n">finite_inds</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">_y</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">_w</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Shape mismatch between x, y, and weights: {}, {}, {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_w</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">_x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">_y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="c"># Basically, this is just doing what np.digitize does with one less copy</span>
    <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">xyi</span> <span class="o">-=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">]</span>
    <span class="n">xyi</span> <span class="o">/=</span> <span class="p">[</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">]</span>
    <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xyi</span><span class="p">,</span> <span class="n">xyi</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c">#xyi contains the bins of each point as a 2d array [(xi,yi)]</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xyi</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_w</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_w</span><span class="p">[</span><span class="n">e</span><span class="p">]]</span>

    <span class="n">_xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
    <span class="n">_w</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">reduce_w</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">])</span>

    <span class="c"># exploit a sparse coo_matrix to build the 2D histogram...</span>
    <span class="n">_grid</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">_w</span><span class="p">,</span> <span class="n">_xyi</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">reinterp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c">#convert sparse to array with filled value</span>
        <span class="c">## grid.toarray() does not account for filled value</span>
        <span class="c">## sparse.coo.coo_todense() does actually add the values to the existing ones, i.e. not what we want -&gt; brute force</span>
        <span class="k">if</span> <span class="n">NULL</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">_grid</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c"># Brute force only went needed</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_grid</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">B</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">NULL</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_grid</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="n">_grid</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">_grid</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                <span class="n">B</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c"># reinterp</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">_grid</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">_grid</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">_grid</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="n">reinterp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">B</span><span class="p">,</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="make_hess"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.make_hess">[docs]</a><span class="k">def</span> <span class="nf">make_hess</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">binsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a hess diagram (surface-density CMD) on photometry data.</span>

<span class="sd">    Paramters</span>
<span class="sd">    ---------</span>
<span class="sd">    color: ndarray</span>
<span class="sd">        color values</span>

<span class="sd">    mag: ndarray</span>
<span class="sd">        magnitude values</span>

<span class="sd">    binsize: sequence</span>
<span class="sd">        width of bins, in magnitudes</span>

<span class="sd">    cbin: sequence, optional</span>
<span class="sd">        set the centers of the color bins</span>

<span class="sd">    mbin: sequence, optional</span>
<span class="sd">        set the centers of the magnitude bins</span>

<span class="sd">    cbinsize: sequence, optional</span>
<span class="sd">        width of bins, in magnitudes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Cbin: sequence</span>
<span class="sd">        the centers of the color bins</span>

<span class="sd">    Mbin: sequence</span>
<span class="sd">        the centers of the magnitude bins</span>

<span class="sd">    Hess:</span>
<span class="sd">        The Hess diagram array</span>

<span class="sd">    2009-02-08 23:01 IJC: Created, on a whim, for LMC data (of course)</span>
<span class="sd">    2009-02-21 15:45 IJC: Updated with cbin, mbin options</span>
<span class="sd">    2012 PAR: Gutted and changed it do histogram2d for faster implementation.</span>
<span class="sd">    2014 MF: refactored and replace np.histogram with crazy_histogram2d</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;mbin&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;cbin&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;verbose&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;mbin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mag</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mag</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">binsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;mbin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;cbin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cbinsize</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cbinsize&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cbinsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cbinsize</span> <span class="o">=</span> <span class="n">binsize</span>
        <span class="n">cbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">cbinsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;cbin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">hess</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="p">(</span><span class="n">cbin</span><span class="p">,</span> <span class="n">mbin</span><span class="p">)</span> <span class="o">=</span> <span class="n">crazy_histogram2d</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">cbin</span><span class="p">,</span> <span class="n">mbin</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">cbin</span><span class="p">,</span> <span class="n">mbin</span><span class="p">,</span> <span class="n">hess</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_hess"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.plot_hess">[docs]</a><span class="k">def</span> <span class="nf">plot_hess</span><span class="p">(</span><span class="n">hess</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filter1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">filter2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">imshow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plots a hess diagram with imshow.</span>

<span class="sd">    default kwargs passed to imshow:</span>

<span class="sd">    default_kw = {&#39;norm&#39;: LogNorm(vmin=None, vmax=hess[2].max())</span>
<span class="sd">                  &#39;cmap&#39;: cm.gray,</span>
<span class="sd">                  &#39;interpolation&#39;: &#39;nearest&#39;,</span>
<span class="sd">                  &#39;extent&#39;: [hess[0][0], hess[0][-1],</span>
<span class="sd">                             hess[1][-1], hess[1][0]]}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">cbin</span><span class="p">,</span> <span class="n">mbin</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">hess</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span> <span class="ow">or</span> <span class="n">h</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                <span class="s">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                <span class="s">&#39;interpolation&#39;</span><span class="p">:</span> <span class="s">&#39;nearest&#39;</span><span class="p">,</span>
                <span class="s">&#39;extent&#39;</span><span class="p">:</span> <span class="n">extent</span><span class="p">,</span>
                <span class="s">&#39;aspect&#39;</span><span class="p">:</span> <span class="s">&#39;auto&#39;</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">imshow</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">filter1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$</span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filter2</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$</span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filter1</span><span class="p">,</span> <span class="n">filter2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ax</span>

</div>
<div class="viewcode-block" id="plot_cmd_redding_vector"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.plot_cmd_redding_vector">[docs]</a><span class="k">def</span> <span class="nf">plot_cmd_redding_vector</span><span class="p">(</span><span class="n">filter1</span><span class="p">,</span> <span class="n">filter2</span><span class="p">,</span> <span class="n">photsys</span><span class="p">,</span> <span class="n">dmag</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add an arrow to show the reddening vector &quot;&quot;&quot;</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">Afilt1</span> <span class="o">=</span> <span class="n">parse_mag_tab</span><span class="p">(</span><span class="n">photsys</span><span class="p">,</span> <span class="n">filter1</span><span class="p">)</span>
    <span class="n">Afilt2</span> <span class="o">=</span> <span class="n">parse_mag_tab</span><span class="p">(</span><span class="n">photsys</span><span class="p">,</span> <span class="n">filter2</span><span class="p">)</span>

    <span class="n">Rslope</span> <span class="o">=</span> <span class="n">Afilt2</span> <span class="o">/</span> <span class="p">(</span><span class="n">Afilt1</span> <span class="o">-</span> <span class="n">Afilt2</span><span class="p">)</span>
    <span class="n">dcol</span> <span class="o">=</span> <span class="n">dmag</span> <span class="o">/</span> <span class="n">Rslope</span>
    <span class="n">pstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">pend</span> <span class="o">=</span> <span class="n">pstart</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dcol</span><span class="p">,</span> <span class="n">dmag</span><span class="p">])</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pstart</span><span class="p">,</span> <span class="n">pend</span><span class="p">])</span>
    <span class="n">data_to_display</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span>
    <span class="n">display_to_axes</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span>
    <span class="n">ax_coords</span> <span class="o">=</span> <span class="n">display_to_axes</span><span class="p">(</span><span class="n">data_to_display</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
    <span class="n">dy_ax_coords</span> <span class="o">=</span> <span class="n">ax_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">dx_ax_coords</span> <span class="o">=</span> <span class="n">ax_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">arr</span> <span class="o">=</span> <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">dx_ax_coords</span><span class="p">,</span> <span class="n">dy_ax_coords</span><span class="p">,</span>
                     <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">,</span>
                     <span class="n">width</span><span class="o">=.</span><span class="mo">005</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="setup_multiplot"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.setup_multiplot">[docs]</a><span class="k">def</span> <span class="nf">setup_multiplot</span><span class="p">(</span><span class="n">nplots</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Quick ways to prepare a figure with multiple subplots</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nplots: int</span>
<span class="sd">        number of panels</span>

<span class="sd">    xlabel: str, optional</span>
<span class="sd">        global xlabel string</span>

<span class="sd">    ylabel: str, optional</span>
<span class="sd">        global ylabel string</span>

<span class="sd">    title: str, optional</span>
<span class="sd">        figure title</span>

<span class="sd">    **kargs: dict</span>
<span class="sd">        extra arguement are forwarded to `:func: plt.subplots`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig: plt.Figure instance</span>
<span class="sd">        figure instance</span>

<span class="sd">    axes: list(plt.Axes)</span>
<span class="sd">        list of newly created axes</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nplots</span><span class="p">))</span>
    <span class="n">nextra</span> <span class="o">=</span> <span class="n">nplots</span> <span class="o">-</span> <span class="n">nx</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="n">nx</span>
    <span class="k">if</span> <span class="n">nextra</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ny</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>

    <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ny</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                           <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;figure fraction&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                           <span class="n">rotation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
                           <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;figure fraction&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="mf">0.04</span><span class="p">),</span>
                           <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;figure fraction&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_numbs"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.plot_numbs">[docs]</a><span class="k">def</span> <span class="nf">plot_numbs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot numbers on a figure</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    item: value</span>
<span class="sd">        item to put on the plot</span>

<span class="sd">    xpos: float</span>
<span class="sd">        x coordinate</span>

<span class="sd">    ypos: float</span>
<span class="sd">        y coordinate</span>

<span class="sd">    ax: plt.Axes, optional</span>
<span class="sd">        axes to plot in</span>

<span class="sd">    **kwargs: dict</span>
<span class="sd">        extra arguments are forwarded to `:func: plt.annotate`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">r&#39;$</span><span class="si">%i</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_hlines"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.plot_hlines">[docs]</a><span class="k">def</span> <span class="nf">plot_hlines</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot horizontal lines on multiple axes.</span>

<span class="sd">    Plot horizontal lines at each `y` from `xmin` to `xmax`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : scalar or 1D array_like</span>
<span class="sd">        y-indexes where to plot the lines.</span>

<span class="sd">    xmin, xmax : scalar or 1D array_like</span>
<span class="sd">        Respective beginning and end of each line. If scalars are</span>
<span class="sd">        provided, all lines will have same length.</span>

<span class="sd">    **kwargs: optional</span>
<span class="sd">        forwarded to `:func: plt.hlines`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">plot_hlines</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axk</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">axk</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">([</span><span class="n">y</span><span class="p">],</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="setup_plot_by_stage"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.setup_plot_by_stage">[docs]</a><span class="k">def</span> <span class="nf">setup_plot_by_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; prepare a plot by stage</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stage:</span>

<span class="sd">    inds: indices, slice, optional</span>
<span class="sd">        if set, reduces stage to the selction</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig: plt.Figure instance</span>
<span class="sd">        generated figure</span>

<span class="sd">    axs: list(plt.Axes)</span>
<span class="sd">        list newly created axes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">stage</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
    <span class="n">ustage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
    <span class="n">nplots</span> <span class="o">=</span> <span class="n">ustage</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mf">1.</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">axs</span><span class="p">)</span> <span class="o">=</span> <span class="n">setup_multiplot</span><span class="p">(</span><span class="n">nplots</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">axs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="colorplot_by_stage"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.colorplot_by_stage">[docs]</a><span class="k">def</span> <span class="nf">colorplot_by_stage</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">stages</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x: sequence</span>
<span class="sd">        x values to plot</span>

<span class="sd">    y: sequence</span>
<span class="sd">        y values to plot</span>

<span class="sd">    marker: str</span>
<span class="sd">        marker argument</span>

<span class="sd">    stages: sequence</span>
<span class="sd">        list of stages to plot</span>

<span class="sd">    cols: sequence, optional</span>
<span class="sd">        color values, default is made from cmap</span>

<span class="sd">    inds: slice, optional</span>
<span class="sd">        reduce to a smaller subset for the plot</span>

<span class="sd">    cmap: colormap, optional</span>
<span class="sd">        color map for the plots if no color provided</span>

<span class="sd">    ax: plt.Axes, optional</span>
<span class="sd">        axes to plot into</span>

<span class="sd">    **kwargs: optional</span>
<span class="sd">        extra arguments are forwarded to `:func: plt.plot`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax: plt.Axes</span>
<span class="sd">        axes instance</span>

<span class="sd">    cols: list</span>
<span class="sd">        list of stage&#39;s colors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="c"># inds from calc_LFIR are based on only resolved stars.</span>
    <span class="kn">from</span> <span class="nn">TrilegalUtils</span> <span class="kn">import</span> <span class="n">get_label_stage</span>

    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">discrete_colors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">stages</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">stages</span><span class="p">)):</span>
        <span class="n">ind</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">stages</span> <span class="o">==</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">inds</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mew</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">get_label_stage</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cols</span>

</div>
<div class="viewcode-block" id="discrete_colors"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.discrete_colors">[docs]</a><span class="k">def</span> <span class="nf">discrete_colors</span><span class="p">(</span><span class="n">Ncolors</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gist_rainbow&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns list of RGBA tuples length Ncolors</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Ncolors: int</span>
<span class="sd">        number of discrete colors</span>

<span class="sd">    cmap: colormap, optional (default: plt.cm.gist_rainbow)</span>
<span class="sd">        colormap to sample</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    values: list</span>
<span class="sd">        sequence of color values</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">Ncolors</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ncolors</span><span class="p">)]</span>

</div>
<div class="viewcode-block" id="stitch_cmap"><a class="viewcode-back" href="../../../resolvedstellarpops.graphics.html#resolvedstellarpops.graphics.plotting.stitch_cmap">[docs]</a><span class="k">def</span> <span class="nf">stitch_cmap</span><span class="p">(</span><span class="n">cmap1</span><span class="p">,</span> <span class="n">cmap2</span><span class="p">,</span> <span class="n">stitch_frac</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dfrac</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Stitch two color maps together</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmap1: cmap</span>
<span class="sd">        colors from 0 and stitch_frac</span>

<span class="sd">    cmap2: cmap</span>
<span class="sd">        colors from stitch_frac to 1</span>

<span class="sd">    stitch_frac: float</span>
<span class="sd">        where the junction is located</span>

<span class="sd">    dfrac: float</span>
<span class="sd">        spacing inbetween</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap: cmap</span>
<span class="sd">        new colormap</span>

<span class="sd">    .. Example:</span>
<span class="sd">        stitch black to white to white to red:</span>

<span class="sd">        &gt;&gt;&gt; stitched = stitch_cmap(plt.cm.Greys_r, plt.cm.Reds, \</span>
<span class="sd">                                   stitch_frac=0.525, dfrac=0.05)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">seg1</span> <span class="o">=</span> <span class="n">cmap1</span><span class="o">.</span><span class="n">_segmentdata</span>
    <span class="n">seg2</span> <span class="o">=</span> <span class="n">cmap2</span><span class="o">.</span><span class="n">_segmentdata</span>

    <span class="n">frac1</span> <span class="o">=</span> <span class="n">stitch_frac</span> <span class="o">-</span> <span class="n">dfrac</span>
    <span class="n">frac2</span> <span class="o">=</span> <span class="n">stitch_frac</span> <span class="o">+</span> <span class="n">dfrac</span>

    <span class="n">blue_array_1</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i0</span> <span class="o">*</span> <span class="n">frac1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">seg1</span><span class="p">[</span><span class="s">&#39;blue&#39;</span><span class="p">]]</span>
    <span class="n">blue_array_2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">frac2</span><span class="p">)</span> <span class="o">+</span> <span class="n">frac2</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">seg2</span><span class="p">[</span><span class="s">&#39;blue&#39;</span><span class="p">]]</span>

    <span class="n">red_array_1</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i0</span> <span class="o">*</span> <span class="n">frac1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">seg1</span><span class="p">[</span><span class="s">&#39;red&#39;</span><span class="p">]]</span>
    <span class="n">red_array_2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">frac2</span><span class="p">)</span> <span class="o">+</span> <span class="n">frac2</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">seg2</span><span class="p">[</span><span class="s">&#39;red&#39;</span><span class="p">]]</span>

    <span class="n">green_array_1</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i0</span> <span class="o">*</span> <span class="n">frac1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">seg1</span><span class="p">[</span><span class="s">&#39;green&#39;</span><span class="p">]]</span>
    <span class="n">green_array_2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">frac2</span><span class="p">)</span> <span class="o">+</span> <span class="n">frac2</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">seg2</span><span class="p">[</span><span class="s">&#39;green&#39;</span><span class="p">]]</span>

    <span class="n">new_segments</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;blue&#39;</span><span class="p">:</span> <span class="n">blue_array_1</span> <span class="o">+</span> <span class="n">blue_array_2</span><span class="p">,</span>
                    <span class="s">&#39;red&#39;</span><span class="p">:</span> <span class="n">red_array_1</span> <span class="o">+</span> <span class="n">red_array_2</span><span class="p">,</span>
                    <span class="s">&#39;green&#39;</span><span class="p">:</span> <span class="n">green_array_1</span> <span class="o">+</span> <span class="n">green_array_2</span><span class="p">}</span>

    <span class="n">new_cmap_name</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">cmap1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cmap2</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="n">new_cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="n">new_cmap_name</span><span class="p">,</span> <span class="n">new_segments</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_cmap</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Phil Rosesenfield.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>