

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>resolvedstellarpops.galaxies.starpop &mdash; ResolvedStellarPops 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../../../',
        VERSION:'1.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
    <script type="text/javascript">
        jQuery(function () {
            SphinxRtdTheme.StickyNav.enable();
        });
    </script>
  

  
    <link rel="top" title="ResolvedStellarPops 1.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../../index.html" class="fa fa-home"> ResolvedStellarPops</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="simple">
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ResolvedStellarPops</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>resolvedstellarpops.galaxies.starpop</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for resolvedstellarpops.galaxies.starpop</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="c">#import pyfits</span>

<span class="kn">from</span> <span class="nn">..graphics</span> <span class="kn">import</span> <span class="n">scatter_contour</span><span class="p">,</span> <span class="n">colorify</span><span class="p">,</span> <span class="n">make_hess</span><span class="p">,</span> <span class="n">plot_hess</span><span class="p">,</span> <span class="n">plot_cmd_redding_vector</span>
<span class="kn">from</span> <span class="nn">..tools</span> <span class="kn">import</span> <span class="n">get_dmodAv</span><span class="p">,</span> <span class="n">mag2Mag</span><span class="p">,</span> <span class="n">Mag2mag</span>
<span class="kn">from</span> <span class="nn">..angst_tables</span> <span class="kn">import</span> <span class="n">angst_data</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">math</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;StarPop&#39;</span><span class="p">,</span> <span class="s">&#39;plot_cmd&#39;</span><span class="p">,</span> <span class="s">&#39;color_by_arg&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="StarPop"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop">[docs]</a><span class="k">class</span> <span class="nc">StarPop</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="StarPop.plot_cmd"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.plot_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">plot_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        plot a stellar color-magnitude diagram</span>
<span class="sd">        see :func: plot_cmd</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">plot_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StarPop.color_by_arg"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.color_by_arg">[docs]</a>    <span class="k">def</span> <span class="nf">color_by_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        see :func: color_by_arg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">color_by_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StarPop.redding_vector"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.redding_vector">[docs]</a>    <span class="k">def</span> <span class="nf">redding_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmag</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add an arrow to show the reddening vector &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">plot_cmd_redding_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="n">dmag</span><span class="o">=</span><span class="n">dmag</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StarPop.decorate_cmd"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.decorate_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">decorate_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag1_err</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mag2_err</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">trgb</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">reddening</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dmag</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">text_kw</span><span class="o">=</span><span class="p">{},</span> <span class="n">errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">cmd_errors_kw</span><span class="o">=</span><span class="p">{},</span> <span class="n">filter1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add annotations on the cmd, such as reddening vector, typical errors etc</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redding_vector</span><span class="p">(</span><span class="n">dmag</span><span class="o">=</span><span class="n">dmag</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">cmd_errors_kw</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd_errors</span><span class="p">(</span><span class="o">**</span><span class="n">cmd_errors_kw</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text_on_cmd</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">text_kw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trgb</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filter1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">put_a_line_on_it</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trgb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">put_a_line_on_it</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trgb</span><span class="p">,</span> <span class="n">filter1</span><span class="o">=</span><span class="n">filter1</span><span class="p">,</span> <span class="n">consty</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StarPop.put_a_line_on_it"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.put_a_line_on_it">[docs]</a>    <span class="k">def</span> <span class="nf">put_a_line_on_it</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">consty</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span>
                         <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">filter1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">annotate_fmt</span><span class="o">=</span><span class="s">&#39;$TRGB=</span><span class="si">%.2f</span><span class="s">$&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if consty is True: plots a constant y value across ax.xlims().</span>
<span class="sd">        if consty is False: plots a constant x on a plot of y vs x-y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="c"># y axis is magnitude...</span>
        <span class="n">yarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">consty</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c"># just a contsant y value over the plot range of x.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
            <span class="n">new_xarr</span> <span class="o">=</span> <span class="n">xarr</span>
        <span class="k">if</span> <span class="n">consty</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="c"># a plot of y vs x-y and we want to mark</span>
            <span class="c"># where a constant value of x is</span>
            <span class="c"># e.g, f814w vs f555-f814; val is f555</span>
            <span class="n">new_xarr</span> <span class="o">=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">yarr</span>
            <span class="c"># e.g, f555w vs f555-f814; val is f814</span>
            <span class="k">if</span> <span class="n">filter1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">yarr</span> <span class="o">=</span> <span class="n">xarr</span> <span class="o">+</span> <span class="n">val</span>
                <span class="n">new_xarr</span> <span class="o">=</span> <span class="n">xarr</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">new_xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annotate</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_xarr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">yarr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">annotate_fmt</span> <span class="o">%</span> <span class="n">val</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StarPop.text_on_cmd"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.text_on_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">text_on_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">distance_av</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a text on the cmd</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">distance_av</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="s">&#39;$</span><span class="si">%s</span><span class="s">$ $\mu=</span><span class="si">%.3f</span><span class="s">$ $A_v=</span><span class="si">%.2f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dmod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Av</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="o">.</span><span class="mi">17</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="s">&#39;$</span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-DEEP&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;\!-\!&#39;</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="o">.</span><span class="mi">09</span>
        <span class="k">if</span> <span class="n">extra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">+=</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">extra</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">strings</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">offset</span> <span class="o">-=</span> <span class="mf">0.04</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StarPop.annotate_cmd"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.annotate_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">annotate_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yval</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">text_kw</span><span class="o">=</span><span class="p">{},</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">yval</span> <span class="o">-</span> <span class="n">offset</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">text_kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="StarPop.make_hess"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.make_hess">[docs]</a>    <span class="k">def</span> <span class="nf">make_hess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">absmag</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">useasts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">slice_inds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        adds a hess diagram of color, mag2 or Color, Mag2 (if absmag is True).</span>
<span class="sd">        if useasts is true will use ast_mags.</span>

<span class="sd">        slice_inds will slice the arrays and only bin those stars, there</span>
<span class="sd">        is no evidence besides the hess tuple itself that hess is not of the</span>
<span class="sd">        full cmd.</span>

<span class="sd">        See `:func: helpers.make_hess`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">absmag</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Color</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mag2</span>
        <span class="k">elif</span> <span class="n">useasts</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ast_color</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">]</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ast_mag2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag2</span>
        <span class="k">if</span> <span class="n">slice_inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">slice_inds</span><span class="p">]</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">mag</span><span class="p">[</span><span class="n">slice_inds</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hess</span> <span class="o">=</span> <span class="n">make_hess</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">binsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="StarPop.hess_plot"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.hess_plot">[docs]</a>    <span class="k">def</span> <span class="nf">hess_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plots a hess diagram with imshow.</span>

<span class="sd">        See `:func: helpers.plot_hess`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;hess&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;run self.make_hess before plotting&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;filter2&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;filter1&#39;</span><span class="p">):</span>
            <span class="n">filter1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter1</span>
            <span class="n">filter2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filter1</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">filter2</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_hess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hess</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">filter1</span><span class="o">=</span><span class="n">filter1</span><span class="p">,</span> <span class="n">filter2</span><span class="o">=</span><span class="n">filter2</span><span class="p">,</span>
                       <span class="n">colorbar</span><span class="o">=</span><span class="n">colorbar</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>
</div>
<div class="viewcode-block" id="StarPop.get_header"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.get_header">[docs]</a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        utility for writing data files, sets header attribute and returns</span>
<span class="sd">        header string.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">key_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">key_dict</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">key_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                                      <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="s">&#39;# </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span>
</div>
<div class="viewcode-block" id="StarPop.delete_data"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.delete_data">[docs]</a>    <span class="k">def</span> <span class="nf">delete_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        for wrapper functions, I don&#39;t want gigs of data stored when they</span>
<span class="sd">        are no longer needed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">data_names</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">data_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="s">&#39;mag1&#39;</span><span class="p">,</span> <span class="s">&#39;mag2&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;stage&#39;</span><span class="p">,</span> <span class="s">&#39;ast_mag1&#39;</span><span class="p">,</span>
                          <span class="s">&#39;ast_mag2&#39;</span><span class="p">,</span> <span class="s">&#39;ast_color&#39;</span><span class="p">,</span> <span class="s">&#39;rec&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">data_name</span> <span class="ow">in</span> <span class="n">data_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__delattr__</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data_name</span><span class="o">.</span><span class="n">title</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__delattr__</span><span class="p">(</span><span class="n">data_name</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="StarPop.convert_mag"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.convert_mag">[docs]</a>    <span class="k">def</span> <span class="nf">convert_mag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmod</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">Av</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shift_distance</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">useasts</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert from mag to Mag or from Mag to mag or just shift distance.</span>
<span class="sd">        pass dmod, Av, or use AngstTables to look it up from target.</span>
<span class="sd">        shift_distance: for the possibility of doing dmod, Av fitting of model</span>
<span class="sd">        to data the key here is that we re-read the mag from the original data</span>
<span class="sd">        array.</span>

<span class="sd">        useasts only work with shift_distance is true.</span>
<span class="sd">        It will calculate the original dmod and av from self, and then shift</span>
<span class="sd">        that to the new dmod av. there may be a faster way, but this is just</span>
<span class="sd">        multiplicative effects.</span>
<span class="sd">        Without shift_distance: Just for common usage. If trilegal was given a</span>
<span class="sd">        dmod, it will swap it back to Mag, if it was done at dmod=10., will</span>
<span class="sd">        shift to given dmod. mag or Mag attributes are set in __init__.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">check</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dmod</span> <span class="o">+</span> <span class="n">Av</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="n">target</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)]</span>

        <span class="c">#assert False in check, &#39;either supply dmod and Av or target&#39;</span>

        <span class="k">if</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;converting mags with angst table using </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">target</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;converting mags with angst table using initialized </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

            <span class="n">tad</span> <span class="o">=</span> <span class="n">angst_data</span><span class="o">.</span><span class="n">get_tab5_trgb_av_dmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
            <span class="n">__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Av</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dmod</span> <span class="o">=</span> <span class="n">tad</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dmod</span> <span class="o">=</span> <span class="n">dmod</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Av</span> <span class="o">=</span> <span class="n">Av</span>

        <span class="n">mag_covert_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Av&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Av</span><span class="p">,</span> <span class="s">&#39;dmod&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dmod</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">shift_distance</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">useasts</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">am1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ast_mag1</span>
                <span class="n">am2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ast_mag2</span>
                <span class="n">old_dmod</span><span class="p">,</span> <span class="n">old_Av</span> <span class="o">=</span> <span class="n">get_dmodAv</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">old_mag_covert_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Av&#39;</span><span class="p">:</span> <span class="n">old_Av</span><span class="p">,</span> <span class="s">&#39;dmod&#39;</span><span class="p">:</span> <span class="n">old_dmod</span><span class="p">}</span>
                <span class="n">M1</span> <span class="o">=</span> <span class="n">mag2Mag</span><span class="p">(</span><span class="n">am1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">old_mag_covert_kw</span><span class="p">)</span>
                <span class="n">M2</span> <span class="o">=</span> <span class="n">mag2Mag</span><span class="p">(</span><span class="n">am2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">old_mag_covert_kw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">M1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">)</span>
                <span class="n">M2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mag1</span> <span class="o">=</span> <span class="n">Mag2mag</span><span class="p">(</span><span class="n">M1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">mag_covert_kw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mag2</span> <span class="o">=</span> <span class="n">Mag2mag</span><span class="p">(</span><span class="n">M2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">mag_covert_kw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;mag1&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Mag1</span> <span class="o">=</span> <span class="n">mag2Mag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mag1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">mag_covert_kw</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Mag2</span> <span class="o">=</span> <span class="n">mag2Mag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mag2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">mag_covert_kw</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mag1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mag2</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trgb&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Trgb</span> <span class="o">=</span> <span class="n">mag2Mag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trgb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">mag_covert_kw</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Mag1&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mag1</span> <span class="o">=</span> <span class="n">Mag2mag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mag1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">mag_covert_kw</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mag2</span> <span class="o">=</span> <span class="n">Mag2mag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mag2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">photsys</span><span class="p">,</span> <span class="o">**</span><span class="n">mag_covert_kw</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag2</span>
</div>
<div class="viewcode-block" id="StarPop.add_data"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.add_data">[docs]</a>    <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">new_cols</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add columns to data</span>
<span class="sd">        new_cols: {new_key: new_vals}</span>
<span class="sd">        new_vals must have same number of rows as data.</span>
<span class="sd">        Ie, be same length as self.data.shape[0]</span>
<span class="sd">        adds new data to self.data.data_array and self.data.key_dict</span>
<span class="sd">        returns new header string (or -1 if nrows != len(new_vals))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># new arrays must be equal length as the data</span>
        <span class="n">len_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="n">nrows</span>
                            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_cols</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">len_test</span><span class="p">:</span>
            <span class="s">&#39;array lengths are not the same.&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_header</span><span class="p">()</span>
        <span class="c"># add new columns to the data and their names to the header.</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="c"># update self.data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">col_keys</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">key_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">col_keys</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_keys</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">header</span>
</div>
<div class="viewcode-block" id="StarPop.slice_data"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.slice_data">[docs]</a>    <span class="k">def</span> <span class="nf">slice_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_to_slice</span><span class="p">,</span> <span class="n">slice_inds</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        slice already set attributes by some index list.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_to_slice</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">slice_inds</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">title</span><span class="p">()):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">slice_inds</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="StarPop.double_gaussian_contamination"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.double_gaussian_contamination">[docs]</a>    <span class="k">def</span> <span class="nf">double_gaussian_contamination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_verts</span><span class="p">,</span> <span class="n">dcol</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">Color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                      <span class="n">Mag2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">color_sep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">diag_plot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                      <span class="n">absmag</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function fits a double gaussian to a color histogram of stars</span>
<span class="sd">        within the &lt;maglimits&gt; and &lt;colorlimits&gt; (tuples).</span>

<span class="sd">        It then finds the intersection of the two gaussians, and the fraction</span>
<span class="sd">        of each integrated gaussian that crosses over the intersection color</span>
<span class="sd">        line.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># the indices of the stars within the MS/BHeB regions</span>

        <span class="c"># poisson noise to compare with contamination</span>
        <span class="k">if</span> <span class="n">Color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">absmag</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">Color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Color</span>
                <span class="n">Mag2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mag2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
                <span class="n">Mag2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag2</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Color</span><span class="p">,</span> <span class="n">Mag2</span><span class="p">))</span>
        <span class="n">all_inds</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">points_inside_poly</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">all_verts</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_inds</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;not enough points found within verts&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">poission_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_inds</span><span class="p">)))</span>

        <span class="c"># make a color histogram</span>
        <span class="c">#dcol = 0.05</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="p">[</span><span class="n">all_inds</span><span class="p">]</span>
        <span class="n">col_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">dcol</span><span class="p">,</span> <span class="n">dcol</span><span class="p">)</span>
        <span class="c">#nbins = np.max([len(col_bins), int(poission_noise)])</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">col_bins</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># uniform errors</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[:</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="mf">1.</span>

        <span class="c"># set up inputs</span>
        <span class="n">hist_in</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&#39;y&#39;</span><span class="p">:</span> <span class="n">hist</span><span class="p">,</span> <span class="s">&#39;err&#39;</span><span class="p">:</span> <span class="n">err</span><span class="p">}</span>

        <span class="c"># set up initial parameters:</span>
        <span class="c"># norm = max(hist),</span>
        <span class="c"># mean set to be half mean, and 3/2 mean,</span>
        <span class="c"># sigma set to be same as dcol spacing...</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">dcol</span><span class="p">,</span>
              <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">dcol</span><span class="p">]</span>

        <span class="n">mp_dg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">mpfit</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">mp_double_gauss</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">functkw</span><span class="o">=</span><span class="n">hist_in</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mp_dg</span><span class="o">.</span><span class="n">covar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;not double gaussian&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">poission_noise</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_inds</span><span class="p">)),</span> <span class="n">color_sep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">perc_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp_dg</span><span class="o">.</span><span class="n">perror</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp_dg</span><span class="o">.</span><span class="n">params</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp_dg</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">p</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">perc_err</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">10.</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;not double guassian, errors too large&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">poission_noise</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_inds</span><span class="p">)),</span> <span class="n">color_sep</span>
        <span class="c"># take fit params and apply to guassians on an arb color scale</span>
        <span class="n">color_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col_bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">g_p1</span> <span class="o">=</span> <span class="n">mp_dg</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">g_p2</span> <span class="o">=</span> <span class="n">mp_dg</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">gauss1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">color_array</span><span class="p">,</span> <span class="n">g_p1</span><span class="p">)</span>
        <span class="n">gauss2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">color_array</span><span class="p">,</span> <span class="n">g_p2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">g_p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g_p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c"># color separatrion is the intersection of the two gaussians..</span>
        <span class="c">#double_gauss = gauss1 + gauss2</span>
        <span class="c">#between_peaks = np.arange(</span>
        <span class="n">min_locs</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">gauss1</span> <span class="o">+</span> <span class="n">gauss2</span><span class="p">)[</span><span class="s">&#39;minima_locations&#39;</span><span class="p">]</span>
        <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">g_p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g_p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">ginds</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="p">(</span><span class="n">color_array</span> <span class="o">&gt;</span> <span class="n">g1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">color_array</span> <span class="o">&lt;</span> <span class="n">g2</span><span class="p">))</span>
        <span class="c">#ginds2, = np.nonzero(gauss2)</span>
        <span class="c">#ginds = list(set(ginds1) &amp; set(ginds2))</span>
        <span class="n">min_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gauss1</span><span class="p">[</span><span class="n">ginds</span><span class="p">]</span> <span class="o">-</span> <span class="n">gauss2</span><span class="p">[</span><span class="n">ginds</span><span class="p">]))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">min_locs</span><span class="p">)</span>
        <span class="n">auto_color_sep</span> <span class="o">=</span> <span class="n">color_array</span><span class="p">[</span><span class="n">ginds</span><span class="p">][</span><span class="n">min_locs</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="n">auto_color_sep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auto_color_sep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">auto_color_sep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;using mean as color_sep&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">color_sep</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">color_sep</span> <span class="o">=</span> <span class="n">auto_color_sep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;you want color_sep to be </span><span class="si">%.4f</span><span class="s">, I found it at </span><span class="si">%.4f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color_sep</span><span class="p">,</span> <span class="n">auto_color_sep</span><span class="p">))</span>

        <span class="c"># find contamination past the color sep...</span>
        <span class="n">g12_Integral</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">double_gaussian</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp_dg</span><span class="o">.</span><span class="n">params</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_inds</span><span class="p">))</span> <span class="o">/</span> <span class="n">g12_Integral</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">g1_Integral</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">gaussian</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">g_p1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">g2_Integral</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">gaussian</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">g_p2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">g1_Int_colsep</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">gaussian</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">color_sep</span><span class="p">,</span> <span class="n">g_p1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">g2_Int_colsep</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">gaussian</span><span class="p">,</span> <span class="n">color_sep</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">g_p2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">left_in_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">g1_Integral</span> <span class="o">-</span> <span class="n">g1_Int_colsep</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span>
        <span class="n">right_in_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">g2_Integral</span> <span class="o">-</span> <span class="n">g2_Int_colsep</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span>
        <span class="c"># diagnostic</span>
        <span class="c">#print color_sep</span>
        <span class="k">if</span> <span class="n">diag_plot</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">hist</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">hist</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color_array</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">double_gaussian</span><span class="p">(</span><span class="n">color_array</span><span class="p">,</span> <span class="n">mp_dg</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color_array</span><span class="p">,</span> <span class="n">gauss1</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color_array</span><span class="p">,</span> <span class="n">gauss2</span><span class="p">)</span>
            <span class="c">#ax1.set_ylim((0, 100))</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$\#$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> Mean Mag2: </span><span class="si">%.2f</span><span class="s">, Nbins: </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                                                             <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_verts</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]),</span>
                                                             <span class="nb">len</span><span class="p">(</span><span class="n">col_bins</span><span class="p">)))</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">color_sep</span><span class="p">,</span> <span class="o">*</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s">&#39;left in right: </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">left_in_right</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="s">&#39;right in left: </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">right_in_left</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

            <span class="n">fig_fname</span> <span class="o">=</span> <span class="s">&#39;heb_contamination_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_mag2_</span><span class="si">%.2f</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_verts</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]))</span>

            <span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_fname</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;wrote {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fig_fname</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">left_in_right</span><span class="p">,</span> <span class="n">right_in_left</span><span class="p">,</span> <span class="n">poission_noise</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_inds</span><span class="p">)),</span> <span class="n">color_sep</span>
</div>
<div class="viewcode-block" id="StarPop.stars_in_region"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.stars_in_region">[docs]</a>    <span class="k">def</span> <span class="nf">stars_in_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag2</span><span class="p">,</span> <span class="n">mag_dim</span><span class="p">,</span> <span class="n">mag_bright</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">verts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">col_min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">col_max</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        counts stars in a region. Give mag2 and the mag2 limits.</span>
<span class="sd">        If col_min, col_max, and verts are none, will just give all stars</span>
<span class="sd">        between those mag limits (if no color info is used mag2 can actually</span>
<span class="sd">        be mag1.)</span>
<span class="sd">        If verts are given (Nx2) array, will use those, otherwise will build</span>
<span class="sd">        a polygon from col_* and mag_* limits.</span>

<span class="sd">        Returns indices inside.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">verts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col_min</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">mag2</span><span class="p">,</span> <span class="n">mag_dim</span><span class="p">,</span> <span class="n">mag_bright</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">col_min</span><span class="p">,</span> <span class="n">mag_dim</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">col_min</span><span class="p">,</span> <span class="n">mag_bright</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">col_max</span><span class="p">,</span> <span class="n">mag_bright</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">col_max</span><span class="p">,</span> <span class="n">mag_dim</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">col_min</span><span class="p">,</span> <span class="n">mag_dim</span><span class="p">]])</span>

                <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">mag1</span> <span class="o">-</span> <span class="n">mag2</span><span class="p">,</span> <span class="n">mag2</span><span class="p">))</span>
                <span class="n">inds</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">points_inside_poly</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">verts</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">inds</span>
</div>
<div class="viewcode-block" id="StarPop.make_lf"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.make_lf">[docs]</a>    <span class="k">def</span> <span class="nf">make_lf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stages</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bin_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">hist_it_up</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">stage_inds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        make a lf out of mag</span>

<span class="sd">        ARGS:</span>
<span class="sd">        mag: array to hist</span>
<span class="sd">        bins: bins for the histogram (or give bin_width)</span>
<span class="sd">        stages: evolutionary stages (will add individually)</span>
<span class="sd">        inds: indices of array include</span>
<span class="sd">        bin_width: width of mag bin for histogram</span>
<span class="sd">        stage_inds: indices to slice the stages</span>
<span class="sd">        RETURNS</span>
<span class="sd">        if stages, will name the attributes</span>
<span class="sd">        self.i[stage]_lfhist</span>
<span class="sd">        self.i[stage]_lfbins</span>
<span class="sd">        otherwise,</span>
<span class="sd">        self.lfhist</span>
<span class="sd">        self.lfbins</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># will use the variable again... silly.</span>
        <span class="n">original_bins</span> <span class="o">=</span> <span class="n">bins</span>
        <span class="k">if</span> <span class="n">inds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mag</span><span class="p">))</span>
        <span class="c"># will cycle through stages, so if none are passed, will just make</span>
        <span class="c"># one LF.</span>
        <span class="k">if</span> <span class="n">stages</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">stages</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PMS&#39;</span><span class="p">,</span> <span class="s">&#39;MS&#39;</span><span class="p">,</span> <span class="s">&#39;SUBGIANT&#39;</span><span class="p">,</span> <span class="s">&#39;RGB&#39;</span><span class="p">,</span> <span class="s">&#39;HEB&#39;</span><span class="p">,</span> <span class="s">&#39;RHEB&#39;</span><span class="p">,</span> <span class="s">&#39;BHEB&#39;</span><span class="p">,</span>
                      <span class="s">&#39;EAGB&#39;</span><span class="p">,</span> <span class="s">&#39;TPAGB&#39;</span><span class="p">,</span> <span class="s">&#39;POSTAGB&#39;</span><span class="p">,</span> <span class="s">&#39;WD&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">stages</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sindss</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mag</span><span class="p">))]</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">stages</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">stages</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">stages</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_stages</span><span class="p">(</span><span class="o">*</span><span class="n">stages</span><span class="p">)</span>
            <span class="n">stage_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;i</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">]</span>
            <span class="n">sindss</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stage_names</span><span class="p">]</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stage_names</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sinds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sindss</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stage_inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">s_inds</span> <span class="o">=</span> <span class="n">stage_inds</span>
            <span class="n">s_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">sinds</span><span class="p">)</span>
            <span class="n">imag</span> <span class="o">=</span> <span class="n">mag</span><span class="p">[</span><span class="n">s_inds</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imag</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;no stars found with stage </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">stages</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">original_bins</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">bins</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">imag</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">imag</span><span class="p">))</span> <span class="o">/</span> <span class="n">bin_width</span>

            <span class="k">if</span> <span class="n">hist_it_up</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">hist_it_up</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">threash</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span> <span class="ow">and</span> <span class="n">bins</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">hist</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">imag</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">lfhist&#39;</span> <span class="o">%</span> <span class="n">extra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">hist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">lfbins&#39;</span> <span class="o">%</span> <span class="n">extra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hist</span><span class="p">,</span> <span class="n">bins</span>
</div>
<div class="viewcode-block" id="StarPop.interp_errs"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.StarPop.interp_errs">[docs]</a>    <span class="k">def</span> <span class="nf">interp_errs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag1err</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mag2err</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Many bugs in this function &quot;&quot;&quot;</span>
        <span class="c">#if type(self.data) == pyfits.fitsrec.FITS_rec:</span>
        <span class="c">#    mag1err = self.data.MAG1_ERR</span>
        <span class="c">#    mag2err = self.data.MAG2_ERR</span>
        <span class="c">#if absmag is True:</span>
        <span class="c">#    mag1 = self.Mag1</span>
        <span class="c">#    mag2 = self.Mag2</span>
        <span class="c">#else:</span>
        <span class="c">#    mag1 = self.mag1</span>
        <span class="c">#    mag2 = self.mag2</span>
        <span class="c">#</span>
        <span class="c">#interp_arr = np.linspace(0, 1, len(mag1))</span>
        <span class="c">#mag1e_hist = np.array(np.histogram(mag1err, bins=mag_bins)[0], dtype=float)</span>
        <span class="c">#</span>
        <span class="c">#mag2e_hist = np.array(np.histogram(mag2err, bins=mag_bins)[0], dtype=float)</span>
        <span class="c">#</span>
        <span class="c">#self.fmag1err = interp1d(mag_bins, mag1e_hist, bounds_error=False)</span>
        <span class="c">#self.fmag2err = interp1d(mag_bins, mag2e_hist, bounds_error=False)</span>
        <span class="k">return</span>

</div></div>
<div class="viewcode-block" id="plot_cmd"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.plot_cmd">[docs]</a><span class="k">def</span> <span class="nf">plot_cmd</span><span class="p">(</span><span class="n">starpop</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contour_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">scatter_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{},</span>
             <span class="n">scatter</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">contour_lw</span><span class="o">=</span><span class="p">{},</span>
             <span class="n">color_by_arg_kw</span><span class="o">=</span><span class="p">{},</span> <span class="n">slice_inds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hist_bin_res</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
             <span class="n">log_counts</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    plot a stellar color-magnitude diagram</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    starpop: StarPop instance</span>
<span class="sd">        population to plot</span>

<span class="sd">    color: ndarray, dtype=float, ndim=1</span>
<span class="sd">        colors of the stars</span>

<span class="sd">    mag: ndarray, dtype=float, ndim=1</span>
<span class="sd">        magnitudes of the stars</span>

<span class="sd">    ax: plt.Axes instance, optional (default=plt.gca())</span>
<span class="sd">        axes in which it will make the plot</span>

<span class="sd">    xlim: optional</span>
<span class="sd">        if set, adjust the limits on the color axis</span>

<span class="sd">    ylim: optional</span>
<span class="sd">        if set, adjust the limits on the magnitude axis</span>

<span class="sd">    xlabel: str, optional</span>
<span class="sd">        label of the color axis</span>

<span class="sd">    ylabel: str, optional</span>
<span class="sd">        label of the magntiude axis</span>

<span class="sd">    contour_args: dict, optional</span>
<span class="sd">        keywords for contour plot</span>

<span class="sd">    scatter_args: dict, optional</span>
<span class="sd">        keywords for scatter</span>

<span class="sd">    plot_args: dict, optional</span>
<span class="sd">        kweywords for plot</span>

<span class="sd">    scatter: bool, optional (default=True)</span>
<span class="sd">        CMD will be generated with plt.scatter</span>

<span class="sd">    levels: optional (default=5)</span>

<span class="sd">    threshold: optional (default=75)</span>

<span class="sd">    contour_lw: optional</span>

<span class="sd">    color_by_arg_kw: optional</span>

<span class="sd">    slice_inds: slice instance, optional</span>
<span class="sd">        if set, cull the data and only consider this slice</span>

<span class="sd">    hist_bin_res: optional (default=0.05),</span>

<span class="sd">    log_counts: bool, optional (default=False)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">slice_inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="n">slice_inds</span><span class="p">]</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">mag</span><span class="p">[</span><span class="n">slice_inds</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="n">mag</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">mag</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_by_arg_kw</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">scatter</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">color_by_arg</span><span class="p">(</span><span class="n">starpop</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">color_by_arg_kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">scatter</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">_contour_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span> <span class="s">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
        <span class="n">_contour_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">contour_kwargs</span><span class="p">)</span>

        <span class="n">_scatter_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;marker&#39;</span><span class="p">:</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">:</span> <span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
                           <span class="s">&#39;edgecolors&#39;</span><span class="p">:</span> <span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="s">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">_scatter_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">scatter_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">hist_bin_res</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">hist_bin_res_c</span><span class="p">,</span> <span class="n">hist_bin_res_m</span> <span class="o">=</span> <span class="n">hist_bin_res</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hist_bin_res_c</span> <span class="o">=</span> <span class="n">hist_bin_res</span>
            <span class="n">hist_bin_res_m</span> <span class="o">=</span> <span class="n">hist_bin_res</span>

        <span class="n">ncolbin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">color</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">color</span><span class="p">)))</span> <span class="o">/</span> <span class="n">hist_bin_res_c</span><span class="p">)</span>
        <span class="n">nmagbin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">mag</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">mag</span><span class="p">)))</span> <span class="o">/</span> <span class="n">hist_bin_res_m</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ncolbin</span><span class="p">,</span> <span class="n">nmagbin</span><span class="p">)</span>

        <span class="n">scatter_contour</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">ncolbin</span><span class="p">,</span> <span class="n">nmagbin</span><span class="p">],</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                        <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">log_counts</span><span class="o">=</span><span class="n">log_counts</span><span class="p">,</span>
                        <span class="n">plot_args</span><span class="o">=</span><span class="n">_scatter_kwargs</span><span class="p">,</span>
                        <span class="n">contour_args</span><span class="o">=</span><span class="n">_contour_kwargs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#simple plotting</span>
        <span class="n">_plot_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;marker&#39;</span><span class="p">:</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">:</span> <span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="s">&#39;mew&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;rasterize&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
        <span class="n">_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="o">**</span><span class="n">_plot_kwargs</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span>

</div>
<div class="viewcode-block" id="color_by_arg"><a class="viewcode-back" href="../../../resolvedstellarpops.galaxies.html#resolvedstellarpops.galaxies.starpop.color_by_arg">[docs]</a><span class="k">def</span> <span class="nf">color_by_arg</span><span class="p">(</span><span class="n">starpop</span><span class="p">,</span> <span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="p">,</span> <span class="n">colorcol</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fig</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">labelfmt</span><span class="o">=</span><span class="s">&#39;$</span><span class="si">%.3f</span><span class="s">$&#39;</span><span class="p">,</span> <span class="n">xdata</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">coldata</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">slice_inds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    starpop: StarPop instance</span>
<span class="sd">        population to plot</span>

<span class="sd">    xcol: ndarray</span>

<span class="sd">    ycol: ndarray</span>

<span class="sd">    colorcol: ndarray</span>

<span class="sd">    bins: optional</span>

<span class="sd">    cmap: optional</span>
<span class="sd">        colormap to use</span>

<span class="sd">    ax: plt.Axes instance, optional (default=plt.gca())</span>

<span class="sd">    labelfmt: str, optional (default=&#39;$%.3f$&#39;)</span>
<span class="sd">        colorbar label format</span>

<span class="sd">    xdata: optional</span>

<span class="sd">    ydata: optional</span>

<span class="sd">    coldata: optional</span>

<span class="sd">    xlim: optional</span>
<span class="sd">        if set, adjust the limits on the x-axis</span>

<span class="sd">    ylim: optional</span>
<span class="sd">        if set, adjust the limits on the y-axis</span>

<span class="sd">    slice_inds: slice instance, optional</span>
<span class="sd">        if set, cull the data and only consider this slice</span>


<span class="sd">    legend: bool, optional (default=True)</span>
<span class="sd">        if set, add a legend to the figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdata</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xdata</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="n">ydata</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ydata</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">if</span> <span class="n">xdata</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="n">starpop</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_col</span><span class="p">(</span><span class="n">xcol</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ydata</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">starpop</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_col</span><span class="p">(</span><span class="n">ycol</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">colorcol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">coldata</span> <span class="o">=</span> <span class="n">starpop</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_col</span><span class="p">(</span><span class="n">colorcol</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">slice_inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span><span class="p">[</span><span class="n">slice_inds</span><span class="p">]</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="n">slice_inds</span><span class="p">]</span>
        <span class="n">coldata</span> <span class="o">=</span> <span class="n">coldata</span><span class="p">[</span><span class="n">slice_inds</span><span class="p">]</span>

    <span class="c"># need the bins to be an array to use digitize.</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">coldata</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">coldata</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">colors</span><span class="p">,</span> <span class="n">scalarmap</span> <span class="o">=</span> <span class="n">colorify</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">lbls</span> <span class="o">=</span> <span class="p">[</span> <span class="n">labelfmt</span> <span class="o">%</span> <span class="n">bk</span> <span class="k">for</span> <span class="n">bk</span> <span class="ow">in</span> <span class="n">bins</span> <span class="p">]</span>  <span class="c"># bins are left bin edges.</span>

    <span class="c"># fake out the legend...</span>
    <span class="k">if</span> <span class="n">labelfmt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">lbls</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">999</span><span class="p">],</span> <span class="p">[</span><span class="mi">999</span><span class="p">],</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="n">inds</span><span class="p">],</span> <span class="n">ydata</span><span class="p">[</span><span class="n">inds</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
               <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">inds</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">legend</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Phil Rosesenfield.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>